name: PR Closed

on:
  pull_request:
    types: [closed]

jobs:
  cleanup-sandbox:
    # Skip forks - they don't have access to secrets
    if: github.event.pull_request.head.repo.full_name == github.repository
    runs-on: ubuntu-latest
    steps:
      - name: Trigger sandbox cleanup
        env:
          GH_TOKEN: ${{ secrets.ECOSYSTEM_DISPATCH_TOKEN }}
        run: |
          gh workflow run close-sandbox.yml \
            --repo aws-infra-example/infra-ecosystem \
            --field sandbox_id="pr-${{ github.event.pull_request.number }}"

      - name: Summary
        run: |
          echo "## Sandbox Cleanup Triggered" >> $GITHUB_STEP_SUMMARY
          echo "- Sandbox: pr-${{ github.event.pull_request.number }}" >> $GITHUB_STEP_SUMMARY
          echo "- S3 data will expire via lifecycle rule" >> $GITHUB_STEP_SUMMARY
